# MeSS
Description : we were given 140 key and a ciphered text.

## Walkthrough

The first thing i did was looking some of the keys. i noticed that there are private and public keys. 
I tried to bruteforce decoding the message using all the given private key but got nothing from it.
Then i started looking at the public keys, using Rsactftool to retrive the private keys doesn't seem to work. my computer always crashes so i gave up on that.
Then i had an idea to see if some of the private and public keys uses the same modulus (n).
(Don't mind my messy script :p)
```python
import glob
import subprocess
for filename in glob.glob('Crypto_/*.key'):
    f = open(filename,"r")
    content=f.readlines()
    n=int(content[0].split(" ")[2],16)
    for filename1 in glob.glob('Crypto_/*.key'):
        g = open(filename1,"r")
        content1=g.readlines()
        n1=int(content1[0].split(" ")[2],16)
        if(n==n1 and filename!=filename1):
            print(filename+":"+filename1)

```

Output
```bash
Crypto_/9hpUS3qszH.key:Crypto_/f3elfj6rlU.key
Crypto_/f3elfj6rlU.key:Crypto_/9hpUS3qszH.key
```
That's a hit! 
So 9hpUS3qszH.key and 3elfj6rlU.key uses the same modulus !

looking closely at those 2 keys

9hpUS3qszH.key

```bash
n = 00b3d6bd85c58f72c351318961a9bc77b5c27e93a37eebaf66ccf9daa31d6dc0e6ab03e55c6ba06bbf31c77bb9e4eb3b245abeb8750ea9eabe2a2f0a761d72c9ea58a84bf6131ea2c4610418dded3a659829c42bba3ecac7160297cc9227c9267260bbf61d93fc8ce755a284f3135568e571b453d5fe40f64c2c897446a089c47683a21662d50353236ee9cd8ccff24407fda2af4fc3fde5e56ae83b6c4dfa7c51ef962d295a289364ce7b14373d1f784f406baedf32774873334bca1321555981848684337fc6080f0f8ff20710775029974b40601ab1b9953370af7466510db4603a482b1fd35eba28dd9ae2141c16ef2f0b1a219fd3ac69f4dc8bd71ef722a9

e = 65537

d = 43fe2a858b1e231ba974fb260b90900a0e50e0ecedad9a1159ea15399a84c66befb8775d2bebe910ce7747560f30c899841d9b8bd65173c91615d6f4b5499301a1277020c735cc004755cf3908da0d532c6758c8ffb896f0c16637180326cffc6a8a6610e4c49559594d2acae44264786b36ec8379af81ef66df4930f2bd63a370f475ce2353a8cb20f91e74ce7f418841fdd075aab74782b793669290549e3725355461027429e59487b5490f20495a50a086076a829d5c9e82ef16d4f9739a4fbc52954a1609b2d69daf02fd8ddaf65e9308f3b9324c79b7fc12acc0847914c0a4b7bfa2249a1f887894516fac570d7f854e898b1b70bb21fd9d2f5a5ec849

First prime = b5349890aea227801b284c3ddda57602

Second prime = 590e9df02867430e6c1e10dd913e860f

Exp_1 = e02813cc1f8ac0810000d546        

Exp_2 = 78d1a6f7d6c534d70000fc47        

Coef = db280abd494a5f50
```
f3elfj6rlU.key

```bash
n = 00b3d6bd85c58f72c351318961a9bc77b5c27e93a37eebaf66ccf9daa31d6dc0e6ab03e55c6ba06bbf31c77bb9e4eb3b245abeb8750ea9eabe2a2f0a761d72c9ea58a84bf6131ea2c4610418dded3a659829c42bba3ecac7160297cc9227c9267260bbf61d93fc8ce755a284f3135568e571b453d5fe40f64c2c897446a089c47683a21662d50353236ee9cd8ccff24407fda2af4fc3fde5e56ae83b6c4dfa7c51ef962d295a289364ce7b14373d1f784f406baedf32774873334bca1321555981848684337fc6080f0f8ff20710775029974b40601ab1b9953370af7466510db4603a482b1fd35eba28dd9ae2141c16ef2f0b1a219fd3ac69f4dc8bd71ef722a9

e = 257
```

I saw that the public exponent is different.
So the trick here is factorizing n using the private key or find d directly.
I did both lol.

## First Method

I came across this amazing stackexchange  Answer and i followed its logic
```bash
https://crypto.stackexchange.com/questions/5799/why-the-following-attack-in-common-modulus-rsa-works
```
To make things clear ea,da refers to the private key public exponent and private exponent.
eb,db refers to the public key public exponent and private exponent.

so following the link I gave I calculated V=ea*da-1

```bash
V=ea*da-1=562523758839174978946682774808179089666001126959064258914764854305666962544065808786741025155738522577720343321378790779140655404595310061499573786326265027339135255830974329614724097605231918027682397842786200916599160867894946722197680596907664102969308565462107739871022350912093773096268727072138770534178620162930480886183939810494269245614923196175155299115356913296907482998972217395057958775788478676478648157370333784226521002222870743217181709746260146291174342242127053382725335291192205562185656722725402359301725154363571648384219228456751679368730165963659468689956973627707011300814846082270001333461829704
```

Then I calcualted modinverse(eb,V)

```bash
modinv(eb,V)=542824483237803092524425401371316786915051671151159284867166085088736991093106305755298732446004488713130914956038677483373083814551116323937331902758419170350605227416660053480356327650184885878853053171248940962321369242170999171614882443708563025433418382235808247035072151852915391937255425345877101527145127628041864824021856315185131412110898648449177097979021457189233680092393423789783555550177208995201185770536353223689405480744248810575334879443861931051405590957383304431579311876325552449113007265509337685240575246234108049802670695164491892931692922797616919202760036808059684056817439021023191948243322049
```

Which is finally db.

We're finally here we just need to decrypt the message now.

```bash
m = pow(c,db,n)= 225867495516870385052319556599900461280701497334325927913753050855739983596381901143880117407592338807453086386821505176563420351178669173584377213
```

Converting from decimal to ASCII

Flag : HZVII{uN7rUst3D_uniQue_k3yZ_0bViousLy_CoMMoN_m0Dulu5_A77aCk5}

## Second Method

So here i factored n using a script i found.

Link is here : https://gist.github.com/ddddavidee/b34c2b67757a54ce75cb

Output

```bash
Found factors p and q
p = 147504216621469380189409215874248864722589246550249379639840285872093233515595729240033319188381256063459342484480536624408619622982123945727439636240158758189207656414303429995920517843643171968009969688682973266810282225644661133313966156163713808164749325692764355471603647680864498925757106384432867755327
q = 153911186463541828405348779050505772007052654252098126319906724330785601180476549150297007215613778549116636075023789423035124242659679051063611847192928471457949573015601406901727072212522607132879243268324932705944030880046781379065510811111157918933296379352833989404101863466218445331033866033394766583319
```

So i calculated phi=(p-1)*(q-1)

```bash
phi=22702548988585639637851431705875336575429862255188645528887111724338807108889571748597184000150880723937377646354782096179701969674522159233980700069669264159299994181571326564481560158416010897880474527515788236201435179106261470748150803007008802283045789226818457497417965570752028940845456738725432663418299304339756271135036718479872033481916344990522047748622040249289994470860126620189602016941983964665374451423453619510312414328148790992702466290510135858066605143358102081795356174477044376551200933195794751767766775137766230058286351943528601152987737749764285603759664768250343502333313668668577017251668
```

I then calculated db = modinv(eb,phi)

```bash
db = 6536920720448783397669283837489396523664629598770271475243759796113119556645246340063002396930603788215431695837563716409719633291496652853364092627064301742366535289635323602224262458065310530907218346444234745054109740287406026596743810982562845793561822578928271808595056234379961640554722952006544813591261278292381183128376331391091558278839725794936309468474828709912294127796301050171325094372400052082637001577181197835654158211217939818910437764582685033061979691083655852345744579421405773792952797885170473271652690117489109044020194723039363756113200752850416866452199193970916027909203157515465755940169
```

m = pow(c,db,n)

```bash
m = 225867495516870385052319556599900461280701497334325927913753050855739983596381901143880117407592338807453086386821505176563420351178669173584377213
```

Flag : HZVII{uN7rUst3D_uniQue_k3yZ_0bViousLy_CoMMoN_m0Dulu5_A77aCk5}
